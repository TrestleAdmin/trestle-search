<div class="search-container">
  <% if admin.searchable? %>
    <div class="searchbox">
      <%= form_tag admin.path, method: :get do %>
        <div class="form-row align-items-center">
          <div class="col">
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text"><icon class="fa fa-search"></icon></span>
              </div>

              <%= search_field_tag :q, params[:q], class: "form-control search-field", autocomplete: "off", placeholder: admin.t("search.placeholder", default: "Search") %>

              <%= link_to icon("fa fa-times"), admin.path, class: "clear-search" if params[:q].present? %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if admin.filterable? %>
    <div class="search-filters">
      <%= form_for admin.filters, as: :f, url: admin.path, method: :get, builder: Trestle::Form::Builder, html: { id: nil, class: nil } do |f| %>
        <% persistent_params.each do |k, v| %>
          <%= hidden_field_tag k, v %>
        <% end %>

        <button type="button" class="btn <%= admin.filters.active(params).any? ? "btn-warning" : "btn-info" %>" data-toggle="search-filters"><%= icon("fa fa-filter") %></button>

        <script id="search-filters" type="text/html">
          <div>
            <% admin.filters.each do |name, filter| %>
              <%= filter.render(f, params[:f]) %>
            <% end %>

            <%= f.submit admin.t("search.filter", default: "Filter"), class: "btn btn-info btn-block" %>
            <%= link_to admin.t("search.reset_filters", default: "Reset Filters"), persistent_params.except(:f), class: "btn btn-light btn-sm btn-block" if admin.filters.active(params).any? %>
          </div>
        </script>
      <% end %>
    </div>
  <% end %>
</div>
